#API接口说明
###使用说明：
    URL构成：http://业务域名/api/v1/模块名/接口名?参数列表，例如http://api.deposit.com/api/v1/account/create?type=1
1.如何携带会话标识
> HTTP Header => Authorization: Bearer-{$token}

2.如何携带设备信息
> HTTP Headere => Device: {$DeviceId}, ...

3.如何表示请求参数
> 使用URL参数列表或POST的参数方式

4.如何表示请求执行结果
> 执行成功：

> StatusCode: 200

> Body:

```
{
  "errno": 0,
  "error": "",
  "data":
}
```

> 业务服务处理异常：

> StatusCode: 499

> Body:

```
{
  "errno": 1000,
  "error": "xxxxx",
  "data":
}
```

> 请求参数异常：

> StatusCode: 服从http statuscode 规范

> Body:

```
{
  "errno": 1000,
  "error": "xxxxx",
  "data":
}
```

5.时间格式：
> 时间点使用unix时间戳=>整数, 范围不做特殊说明为半开半闭区间=>[begin, end)

6.Method？
> 对应HTTP请求类型

7.业务异常编码
> 业务异常时http请求的status code为499，body里面的errno为具体的业务异常错误号，例如账号冲突，鉴权失败等等；当errno不为0时，error不能为空一定要有相关错误描述，并且尽可能准确。

> 数据库错误码区间：[10000 ~ 11000]

8.服务本身异常
> 服务本身异常的情况记录在http的status code中，例如请求的url错误，等等。

##模块列表
###文件上传下载
> 文件上传错误码区间：[11001 ~ 11100]
> 文件下载错误码区间：[11101 ~ 11200]

1.文件上传
* POST
* URL: /upload
* Content-Type:multipart/form-data;boundary=---------------------------7d33a816d302b6
* Request Body:
filedata
* Response Body:
``` 
{
  "errno":0,
  "error":"",
  "data": {
    "fileurl":"http://www.deposit.com/imgs/xxxxxxxx1.jpg",
    "filename":"a.jpg"
  }
}
```
----
* PUT
* URL: /upload?filename=a.jpg
* Request Body:
filedata
* Response Body:
```
{
  "errno":0,
  "error":"",
  "data": {
    "fileurl":"http://www.deposit.com/imgs/xxxxxxxx1.jpg",
    "filename":"a.jpg"
  }
}
```        
2.文件下载
>直接通过上传时返回的文件url进行访问。

###账号模块
>错误码区间：[12001 ~ 12100]
>账号类型包括：家长、孩子、老师、第三方机构、托管机构、顾问；账号设计为8位的整形数字,在系统中我们统一把这个账号叫做uid(user id)，第1位表示类型：
>
>|账号类型  | 表示含义       |
>|--------|---------------|
>|1xxxxxxx|表示托管机构     |
>|2xxxxxxx|表示家长        |
>|3xxxxxxx|表示老师        |
>|4xxxxxxx|表示孩子        |
>|5xxxxxxx|表示第三方机构   |
>|6xxxxxxx|开头表示顾问     |

1.家长账号注册
* POST
* URL: /api/v1/account/register/parent
* Request Body:
```
{
  "weixin": "xxxxxx",
  "name": "李寻欢",
  "mobile": "13812345678",
  "nick":"小李飞刀",
  "password":"abcd"
}
```
* Response Body:
```
{
  "errno":0,
  "error":"",
  "data":{
    "uid":21000001
  }
}
```
2.托管机构账号注册
* POST
* URL: /api/v1/account/register/deposit
* Request Body:
        {
          "name": "机构名称",
          "contactmobile": "13812345678",
          "password":"abcd",
          "address":"托管机构地址",
          "contactname":"托管机构联系人（管理者）",
          "desc":"托管机构信息描述"
        }
* Response Body:
        {
          "errno":0,
          "error":"",
          "data":{
            "uid":11000001
          }
        }

3.老师账号注册
4.第三方机构账号注册
5.孩子账号生成
6.顾问账号

7.登录
* POST
* URL: /api/v1/login
* Request Body:
```
{
  "uid": 11000001,
  "weixinno": "xxxxxx",
  "passwd":"发布信息描述"
}
```
* Response Body:
```
{
  "errno":0,
  "error":"",
  "data":{
    "token":"fdddsdsdddsssssdfff"
  }
}
```
> 登录返回的token需要在API服务的每次请求中带上，放在http的header数据中，

> 例如： Authorization: Bearer-fdddsdsdddsssssdfff

###指纹签到模块
>错误码区间：[13001 ~ 13100]

1.指纹机注册
* GET
* URL: /manager/v1/finger/register?orguid=11000001&deviceid=abcd
* Response Body:
```
{
  "errno":0,
  "error":"",
  "data":{
    "orguid":11000001,
    "orgname":"xxx",
    "orgposition":{
      "latitude":123.456,
      "longitude":456.123,
    }
    "children":[
      {
        "childuid":41000001,
        "childname":"孩子1",
        "parentname":"家长1",
      },
      {
        "childuid":41000002,
        "childname":"孩子2",
        "parentname":"家长3",
      },
      ...
    ]
  }
}
```
>如果是信息重刷而不是注册（以前注册过，后来某些原因需要重刷信息），也调用同一接口，但是后面的deviceid参数可以忽略。如果是注册则一定要两个参数齐全。

2.指纹数据上报
* POST
* URL: /manager/v1/finger/signin
* Request Body:
```
{
  "deviceid":"xxx",
  "orguid": 11000001,
  "childuid": 41000001,
  "fingerid":"fdasfafaaa"
}
```
* Response Body:
```
{
  "errno":0,
  "error":"",
  "data":{}
}
```
        
3.指纹机数据同步
>该接口指纹机约5分钟调用一次，可以直接用来当做心跳

* POST
* URL: /manager/v1/finger/sync
* Request Body:
```
{
  "deviceid":"xxx",
  "orguid": 11000001,
  "succrate": 100,
  "samplecount":1000,
  "devposition":{
      "latitude":123.456,
      "longitude":456.123,
    }
}
```

* Response Body:
```
{
  "errno":0,
  "error":"",
  "data":{
    "orguid":11000001,
    "orgname":"xxx",
    "orgposition":{
      "latitude":123.456,
      "longitude":456.123,
    }
    "children":[
      {
        "childuid":41000001,
        "childname":"孩子1",
        "parentname":"家长1",
      },
      {
        "childuid":41000002,
        "childname":"孩子2",
        "parentname":"家长3",
      },
      ...
    ]
  }
}
```
>成功率和采样个数都是指当前上报周期内的，当周期内没有任何指纹刷卡情况则成功率为100，采样个为0。

###孩子信息模块
>错误码区间：[14001 ~ 14100]

1.生活信息发布
* POST
* URL: /api/v1/deposit/publish
* Request Body:
```
{
  "orguid": 11000001,
  "teacheruid": 11000001,
  "type":"1",
  "lat":"发布者经纬度信息",
  "long":"发布者经纬度信息",
  "desc":"发布信息描述",
  "imgs":["http://www.deposit.com/img/xxxxxxxx1","http://www.deposit.com/img/xxxxxxxx2"]
}
```
* Response Body:
```
{
  "errno":0,
  "error":"",
  "data":""
}
```
       
2.家长拉取相关孩子信息
* GET
* URL: /api/v1/parent/childrenlist/{$parentuid}
* Response Body:
```
{
   "errno":0,
   "error":"",
   "data":[
     {
       "uid":41000001,
       "name":"xxx",
       "avatarlink":"http://xxxxxxx.jpg",
     },
     {
       "uid":41000002,
       "name":"yyy",
       "avatarlink":"http://yyyyyyyyyyy.jpg",
     }
   ]
}
```

3.家长拉取孩子在托管机构情况
* GET
* URL: /api/v1/children/information/{$childuid}
* Response Body:
```
{
   "errno":0,
   "error":"",
   "data":{
       "childuid":41000001,
       "childname":"xxx",
       "childavatarlink":"http://xxxxxxx.jpg",
       "timeline":[
         {
           "timestamp":1468051200,
           "actiontype":0,
           "actionname":"signin",
           "actiondata":{}
         },
         {
           "timestamp":146805200,
           "actiontype":1,
           "actionname":"dining",
           "actiondata":{
             "imgs":["http://xxxxxxxxxx1.jpg", "http://xxxxxxxxx2.jpg",...],
             "desc":"孩子们愉快的享受着美味"
           }
         },
       ]
       "signin":1468051200,
       "name":"yyy",
       "avatarlink":"http://yyyyyyyyyyy.jpg",
     }
   ]
}
```

###广告模块
>错误码区间：[15001 ~ 15100]

###计费模块
>错误码区间：[16001 ~ 16100]

###评分模块
>错误码区间：[17001 ~ 17100]

###后台管理模块
>错误码区间：[18001 ~ 18100]
